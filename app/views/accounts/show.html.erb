<div class="row header-block">
  <div class="col-md-8">
    <h3><%= @account.name %></h3>
    <h4>Transactions</h4>
  </div>

  <div class="col-md-4 header-actions">
    <%= link_to "Back to accounts", accounts_path, class: "btn btn-danger" %>
    <%= link_to "Add transaction", new_account_transaction_path(@account), class: "btn btn-primary" %>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <% if @transactions.any? %>
      <table class="table">
        <thead>
          <tr>
            <th>Transaction date</th>
            <th>Description</th>
            <th>Amount</th>
            <th>Running total</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td></td>
            <td>
              <strong>Starting balance</strong>
            </td>
            <td></td>
            <td>
              <strong><%= as_currency(@account.starting_balance) %></strong>
            </td>
            <td></td>
          </tr>
          <% @transactions.inject(@account.starting_balance) do |total, transaction| %>
            <tr>
              <td>
                <%= format_date(transaction.transaction_date, :longer) %>
              </td>
              <td>
                <%= transaction.description %>
                <% if transaction.tag.present? %>
                  <span class="label label-info">
                    <%= transaction.tag.name %>
                  </span>
                <% end %>
              </td>
              <td>
                <%= as_currency(transaction.amount) %>
              </td>
              <td>
                <%= as_currency(total + transaction.amount) %>
              </td>
              <td>
                <%= link_to "Edit", edit_account_transaction_path(@account, transaction), class: "btn btn-warning" %>
                <%= link_to "Delete", account_transaction_path(@account, transaction), method: :delete, class: "btn btn-danger", data: { confirm: "Are you sure you want to delete this account?" } %>
              </td>
            </tr>
            <%- total + transaction.amount %>
          <% end %>
          <tr>
            <td></td>
            <td>
              <strong>Current balance</strong>
            </td>
            <td></td>
            <td>
              <strong><%= as_currency(@account.current_balance) %></strong>
            </td>
            <td></td>
          </tr>
        </tbody>
      </table>
    <% else %>
      <div class="panel panel-primary">
        <div class="panel-heading">
          <h5>
            You have no transactions.
          </h5>
        </div>
        <div class="panel-body">
          Try adding one <%= link_to "here", new_account_transaction_path(@account) %>.
        </div>
      </div>
    <% end %>
  </div>
</div>
